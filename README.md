Проект автоматизации мониторинга температуры холодильников
===

## Задача

Автоматизировать сбор, обработку, архивирование и отображение значений температур с холодильников. Проект подразумевает полный процесс от рахработки требований до внедрения конечного решения.

## Условия

Известно, что холодильники распределены на четырех этажах. Общее количество - 25 штук. Пять из них работают при отрицательной температуре.

АРМ представляет из себя обычный ноутбук, расположенный в том же здании, что и холодильники.

## Реализация

### Общая концепция

Система состоит из нескольких уровней:
* низкий (группы датчиков температуры, локальный контроллер)
* средний (мастер-контроллер, средства связи)
* верхний (АРМ)

Датчики, объединенные в группу (например на этаже), по запросу от локального контроллера передают значения температуры по какому-то каналу связи. После окончания опроса, локальный контроллер передает измерения на уровень выше по запросу от мастера. 
Мастер (в зависимости от возможностей) либо: 1) передает данные через COM-порт в АРМ; 2) вставляет новые измерения в БД. АРМ, получив свежие измерения, отображает их текущее значение.

### Наброски/заметки

* использование проводов может повлечь к потерям полезной информации, стоит посмотрет в сторону беспроводных каналов связи
* объединение в группы крайне желательно. Таким образом при потере связи в мастером, локальный контроллер может локально хранить данные и при появлении разом отправить их
* потенциальные протоколы для использования:
  * Modbus [статья на хабре с использованием в ардуино] (https://habr.com/ru/post/249043/)
    * де-факто стандарт в M2M
    * не очень сложный в реализации
    * возможно оверкилл для такой простой системы
    * имеет несколько стандартов для применения в различных физических интерфейсах(TCP/IP, RS-485)
    * *необходима ручная настройка записи/чтения из регистров*
  * MQTT [реализация протокола в ардуино] (https://docs.arduino.cc/tutorials/uno-wifi-rev2/uno-wifi-r2-mqtt-device-to-device)
    * распространен в IoT
    * прост в реализации
    * поддерживается многими устройствами
    * схематично: Publisher -> Broker -> Subscriber
    * *как настроить брокера? (URL)* [есть реализация как плагин для Eclipse] (https://mosquitto.org/)
* Возможно подключение Arduino к Raspberry Pi. В таком случае возможна передача "сырых" или структурированных данных с датчика по Serial порту в Малину. Малина в свою очередь может вставлять оперативные данные в БД.
  * **Потенциальные проблемы**: на малине 4 USB входа. Как увеличить кол-во подключенных слейв-контроллеров?

### Вопросы

* Какой датчик температуры использовать? Какой должен быть тип выходного сигнала?
  * **DS18B20** - цифровой, дешевый датчик. Один сигнальный провод, использует протокол ONE-WIRE. Можно найти с хорошей защитой IP
* Как считывать сигнал с датчика?
  * для популярныфх датчиков есть готовые библиотеки для работы с Ардуино
* Какие интерфейсы датчиков проще использовать?
* Какой канал связи использовать между слейв и мастером? Проводной/беспроводной?
  * зависит от выбранного протокола
* Какой тип контроллера брать на группы? На мастера?


### Полезные ссылки

* [Работа с цифровыми входами/выходами Ардуино](https://www.youtube.com/watch?v=3UwgMAdV4xQ)
* [Плейлист с обучением по Ардуино](https://youtube.com/playlist?list=PLgAbBhxTglwmVxDDC5TSYUI91oZ0LZQMw)
* [Видео с работой конкретного термометра DS18B20 и Ардуино] (https://youtu.be/FBLr_v8Q260)
* [Статья о реализации MQTT на ардуино] (https://microkontroller.ru/esp8266-projects/podklyuchenie-nodemcu-esp8266-k-mqtt-brokeru-s-pomoshhyu-arduino-ide/)
